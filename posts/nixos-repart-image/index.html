<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Reproducable, flashable, updateable Raspberry Pi Images with NixOS" /><meta property="og:locale" content="en_US" /><meta name="description" content="A lot of my knowledge laid out here would not be possible without the insight from Nixcademy and their blog series on NixOS images. Please check out the linked blog for more information on this topic. The code in this article is heavily inspired by or reused from that post." /><meta property="og:description" content="A lot of my knowledge laid out here would not be possible without the insight from Nixcademy and their blog series on NixOS images. Please check out the linked blog for more information on this topic. The code in this article is heavily inspired by or reused from that post." /><link rel="canonical" href="https://lyndeno.ca/posts/nixos-repart-image/" /><meta property="og:url" content="https://lyndeno.ca/posts/nixos-repart-image/" /><meta property="og:site_name" content="Lyndon Sanche" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2026-01-16T16:30:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Reproducable, flashable, updateable Raspberry Pi Images with NixOS" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-01-16T16:30:00-07:00","datePublished":"2026-01-16T16:30:00-07:00","description":"A lot of my knowledge laid out here would not be possible without the insight from Nixcademy and their blog series on NixOS images. Please check out the linked blog for more information on this topic. The code in this article is heavily inspired by or reused from that post.","headline":"Reproducable, flashable, updateable Raspberry Pi Images with NixOS","mainEntityOfPage":{"@type":"WebPage","@id":"https://lyndeno.ca/posts/nixos-repart-image/"},"url":"https://lyndeno.ca/posts/nixos-repart-image/"}</script><title>Reproducable, flashable, updateable Raspberry Pi Images with NixOS | Lyndon Sanche</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://github.com/Lyndeno.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Lyndon Sanche</a></div><div class="site-subtitle font-italic">Software Developer, Elecrical Engineer in Training</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/consulting/" class="nav-link"> <i class="fa-fw fas fa-briefcase ml-xl-3 mr-xl-3 unloaded"></i> <span>CONSULTING</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/Lyndeno" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['lsanche','lyndeno.ca'].join('@')" aria-label="email" class="order-4" > <i class="far fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/LyndonSanche" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Reproducable, flashable, updateable Raspberry Pi Images with NixOS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Reproducable, flashable, updateable Raspberry Pi Images with NixOS</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Lyndon Sanche </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 16, 2026, 4:30 PM -0700" prep="on" > Jan 16 <i class="unloaded">2026-01-16T16:30:00-07:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2457 words">13 min</span></div></div><div class="post-content"><p>A lot of my knowledge laid out here would not be possible without the insight from <a href="https://nixcademy.com/posts/auto-growing-nixos-appliance-images-with-systemd-repart/">Nixcademy</a> and their blog series on NixOS images. Please check out the linked blog for more information on this topic. The code in this article is heavily inspired by or reused from that post.</p><p>I hope to add a little more to this topic by showing how to achieve a UEFI-based image for a Raspberry Pi. I also want to practice my technical writing skills for this article.</p><p>AI was only used for basic spelling and grammar. The words are my own</p><h1 id="background">Background</h1><p>I have been using NixOS for almost half a decade. I have completely immersed myself in it. I use it for my laptop, desktop, VPS, and a little Raspberry Pi 4. I have recently started using it in professional life, which has encouraged me to think of its other use cases.</p><p>On a desktop or server system, NixOS is great for the atomic updates and rollbacks, declarative configuration, reproducibility, and module system. This is great when you want a system that can be quickly modified and updated and have the resources to do so.</p><p>On an embedded device, resources may be restricted. Disk space, memory, CPU speed, and network access are all things that can be limited on an embedded system. We may also want to limit specific functionality of the system to reduce attack surface or resource usage.</p><p>My experience so far with NixOS is that it is not optimized for these low resource situations by default, but can be made to fit these use cases! Nix and NixOS provide a pathway to a fully custom Linux build for almost any requirement.</p><p>NixOS uses the systemd suite of software for the init system and optionally networking, time synchronization, boot loader, among others. The existence of systemd in the NixOS stack means we have access to some very interesting and useful pieces of software:</p><ul><li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-repart.html">systemd-repart</a> for building images and partitioning drives.<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-sysupdate.html">systemd-sysupdate</a> for image-based update mechanisms.<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-boot.html">systemd-boot</a> for the bootloader. This enables features such as boot counting.<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-networkd.html">systemd-networkd</a> for declarative network configuration.<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-firstboot.html">systemd-firstboot</a> for configuring a system on first boot.<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-cryptenroll.html">systemd-cryptenroll</a> for easy setup of TPM-backed encryption.</ul><p>I am brain dumping this article (and hopefully more) to hopefully provide some insight and clarity on how NixOS can fit in your desktop and embedded world.</p><h1 id="the-problem">The Problem</h1><p>NixOS already provides an easy way to get started with defining a computer configuration. Using flakes, we can even lock our dependencies down in such a way that we can reproduce the same result over and over. Here is a simple example:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="p">{</span>
  <span class="nv">description</span> <span class="o">=</span> <span class="s2">"My NixOS Configuration"</span><span class="p">;</span>

  <span class="nv">inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">nixpkgs</span><span class="o">.</span><span class="nv">url</span> <span class="o">=</span> <span class="s2">"github:NixOS/nixpkgs/nixos-25.11"</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nv">outputs</span> <span class="o">=</span> <span class="p">{</span> <span class="nv">self</span><span class="p">,</span> <span class="nv">nixpkgs</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span> <span class="o">@</span> <span class="nv">inputs</span><span class="p">:</span> <span class="p">{</span>
    <span class="nv">nixosConfigurations</span><span class="o">.</span><span class="nv">raspberry-pi</span> <span class="o">=</span> <span class="nv">nixpkgs</span><span class="o">.</span><span class="nv">lib</span><span class="o">.</span><span class="nv">nixosSystem</span> <span class="p">{</span>
      <span class="nv">modules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c"># Generic NixOS configuration</span>
        <span class="sx">./configuration.nix</span>
        <span class="p">{</span>
          <span class="c"># Set the host arch</span>
          <span class="nv">nixpkgs</span><span class="o">.</span><span class="nv">hostPlatform</span> <span class="o">=</span> <span class="s2">"aarch64-linux"</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With the above flake, it is trivial to build the NixOS configuration on the target machine and switch to it with something like:</p><pre><code class="language-ShellSession"># nixos-rebuild switch --flake .#raspberry-pi
</code></pre><p>This is great and gets us most of the way there. We are not all the way there yet, however. How do we get NixOS on our device in the first place?</p><h2 id="initial-deployment">Initial Deployment</h2><p>Our target device is a Raspberry Pi. Out of the box, the Pi does not come with UEFI firmware, which would allow us to just plug in an installer USB and continue on our way to installation. Now we can get it set up this way, and we will (see <a href="https://github.com/pftf/RPi4">here</a>), but wouldn’t it be nice if we could directly deploy our desired configuration to a Pi SD card without any additional interaction?</p><h2 id="automatic-updates">Automatic Updates</h2><p>Our device is a lower-power unit but still capable of running Nix to build and apply simple updates. For more complex configurations which involve more code compilation, it is desirable to build our system off-device and deploy it after it is built.</p><p>Nix has built-in support for booting into multiple past generations of a system. For our usage, a simple A/B partitioning scheme will suffice and can simplify our deployment greatly.</p><h2 id="future-considerations">Future Considerations</h2><p>This is out of scope for this article, but other functionalities like using dm-verity for checking our OS data against a hash, secure boot for only loading signed software, and automatic rollbacks on failure are desirable features to be explored in the future.</p><h1 id="the-solution">The Solution</h1><p>Let’s explore the uses of two systemd tools: <code class="language-plaintext highlighter-rouge">systemd-repart</code> and <code class="language-plaintext highlighter-rouge">systemd-sysupdate</code>.</p><h2 id="image-deployment">Image Deployment</h2><p>The goal is to be able to use Nix to generate an appliance image we can deploy directly to an SD card and boot on a Pi. Some desirables for this method:</p><ul><li>Minimal compressed image with no wasted space.<li>Full partition table contained within.<li>Separate Nix store partitions for A/B updates later on.<li>On first boot, automatically grow or create required partitions to fill available space.</ul><p>systemd-repart can solve this for us. From the <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-repart.html">docs</a>:</p><blockquote><p><strong>systemd-repart</strong> is used when building OS images, and also when deploying images to automatically adjust them, during boot, to the system they are running on. This way the image can be minimal in size and may be augmented automatically at boot, taking possession of the disk space available.</p></blockquote><p>NixOS has support for repart in the module system for runtime configuration of partitions on the device. For image creation, NixOS has the <a href="https://github.com/NixOS/nixpkgs/blob/0953fdba8af00798dafbeae5626523320fd170ac/nixos/modules/image/repart.nix">repart.nix</a> profile that can be imported to expose a derivation in the system configuration to build an image that can be used to deploy a configuration. We will use this module to build our Raspberry Pi image.</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="nv">imports</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="nv">modulesPath</span> <span class="o">+</span> <span class="s2">"/image/repart.nix"</span><span class="p">)</span>
<span class="p">];</span>

<span class="nv">system</span><span class="o">.</span><span class="nv">image</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">id</span> <span class="o">=</span> <span class="s2">"trinity"</span><span class="p">;</span>
  <span class="nv">version</span> <span class="o">=</span> <span class="s2">"v0"</span><span class="p">;</span>
<span class="p">};</span>

<span class="nv">image</span><span class="o">.</span><span class="nv">repart</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">name</span> <span class="o">=</span> <span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">image</span><span class="o">.</span><span class="nv">id</span><span class="p">;</span>
  <span class="nv">compression</span><span class="o">.</span><span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nv">split</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nv">partitions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"10-esp"</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">contents</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"/EFI/BOOT/BOOT</span><span class="si">${</span><span class="nv">lib</span><span class="o">.</span><span class="nv">toUpper</span> <span class="nv">efiArch</span><span class="si">}</span><span class="s2">.EFI"</span><span class="o">.</span><span class="nv">source</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pkgs</span><span class="o">.</span><span class="nv">systemd</span><span class="si">}</span><span class="s2">/lib/systemd/boot/efi/systemd-boot</span><span class="si">${</span><span class="nv">efiArch</span><span class="si">}</span><span class="s2">.efi"</span><span class="p">;</span>

        <span class="s2">"/EFI/Linux/</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">boot</span><span class="o">.</span><span class="nv">loader</span><span class="o">.</span><span class="nv">ukiFile</span><span class="si">}</span><span class="s2">"</span><span class="o">.</span><span class="nv">source</span> <span class="o">=</span> <span class="s2">"</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">build</span><span class="o">.</span><span class="nv">uki</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">boot</span><span class="o">.</span><span class="nv">loader</span><span class="o">.</span><span class="nv">ukiFile</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>

        <span class="s2">"/loader/loader.conf"</span><span class="o">.</span><span class="nv">source</span> <span class="o">=</span> <span class="kr">builtins</span><span class="o">.</span><span class="nv">toFile</span> <span class="s2">"loader.conf"</span> <span class="s2">''</span><span class="err">
</span><span class="s2">          timeout 5</span><span class="err">
</span><span class="s2">        ''</span><span class="p">;</span>

        <span class="s2">"/"</span><span class="o">.</span><span class="nv">source</span> <span class="o">=</span> <span class="nv">inputs</span><span class="o">.</span><span class="nv">rpi4-uefi</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nv">repartConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">Format</span> <span class="o">=</span> <span class="s2">"vfat"</span><span class="p">;</span>
        <span class="nv">Label</span> <span class="o">=</span> <span class="s2">"boot"</span><span class="p">;</span>
        <span class="nv">SizeMinBytes</span> <span class="o">=</span> <span class="s2">"200M"</span><span class="p">;</span>
        <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"esp"</span><span class="p">;</span>
        <span class="nv">SplitName</span> <span class="o">=</span> <span class="s2">"-"</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="s2">"20-nix-store"</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">storePaths</span> <span class="o">=</span> <span class="p">[</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">build</span><span class="o">.</span><span class="nv">toplevel</span><span class="p">];</span>
      <span class="nv">nixStorePrefix</span> <span class="o">=</span> <span class="s2">"/"</span><span class="p">;</span>
      <span class="nv">repartConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">Format</span> <span class="o">=</span> <span class="s2">"squashfs"</span><span class="p">;</span>
        <span class="nv">Label</span> <span class="o">=</span> <span class="s2">"nix-store_</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">image</span><span class="o">.</span><span class="nv">version</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
        <span class="nv">Minimize</span> <span class="o">=</span> <span class="s2">"off"</span><span class="p">;</span>
        <span class="nv">SizeMinBytes</span> <span class="o">=</span> <span class="nv">storeSize</span><span class="p">;</span>
        <span class="nv">SizeMaxBytes</span> <span class="o">=</span> <span class="nv">storeSize</span><span class="p">;</span>
        <span class="nv">ReadOnly</span> <span class="o">=</span> <span class="s2">"yes"</span><span class="p">;</span>
        <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"linux-generic"</span><span class="p">;</span>
        <span class="nv">SplitName</span> <span class="o">=</span> <span class="s2">"nix-store"</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">};</span>
    <span class="s2">"30-empty"</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">repartConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">Label</span> <span class="o">=</span> <span class="s2">"_empty"</span><span class="p">;</span>
        <span class="nv">Minimize</span> <span class="o">=</span> <span class="s2">"off"</span><span class="p">;</span>
        <span class="nv">SizeMinBytes</span> <span class="o">=</span> <span class="nv">storeSize</span><span class="p">;</span>
        <span class="nv">SizeMaxBytes</span> <span class="o">=</span> <span class="nv">storeSize</span><span class="p">;</span>
        <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"linux-generic"</span><span class="p">;</span>
        <span class="nv">SplitName</span> <span class="o">=</span> <span class="s2">"-"</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>In your <code class="language-plaintext highlighter-rouge">flake.nix</code> you would have this in your <code class="language-plaintext highlighter-rouge">inputs</code>:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">rpi4-uefi</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">url</span> <span class="o">=</span> <span class="s2">"https://github.com/pftf/RPi4/releases/download/v1.50/RPi4_UEFI_Firmware_v1.50.zip"</span><span class="p">;</span>
  <span class="nv">flake</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>The above configuration sets up an output image that can be used to flash to an SD card. Some things are set up for later, like the “_empty” partition. This image currently contains one ESP partition and two nix store partitions, one being empty and one containing our NixOS configuration. We manually specify the size so that it is predictable.</p><p>Squashfs is being used for the store partitions as it achieves solid compression ratios to reduce the size of our image. Unless we are doing high I/O on the nix store, which is unlikely, this should be fine. If we want to trade off some compression for more performance, erofs is an option that repart is compatible with. Other options like ext4, xfs, etc., will also work here.</p><p>We also compress the entire image (zstd by default) so that our local nix store does not fill up too fast. This compresses down the empty partition completely.</p><p>We need to also set up our image to create a root partition on first boot. Let’s do that now:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nv">boot</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">initrd</span><span class="o">.</span><span class="nv">systemd</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">emergencyAccess</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nv">repart</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nv">device</span> <span class="o">=</span> <span class="s2">"/dev/mmcblk1"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="nv">systemd</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">repart</span><span class="o">.</span><span class="nv">partitions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">root</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Format</span> <span class="o">=</span> <span class="s2">"xfs"</span><span class="p">;</span>
      <span class="nv">Label</span> <span class="o">=</span> <span class="s2">"root"</span><span class="p">;</span>
      <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"root"</span><span class="p">;</span>
      <span class="nv">Weight</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>We enable repart in the initrd to enable creating the root partition on first boot. I also enable emergency access so if this does not work, I can log in to an emergency shell to see what went wrong.</p><blockquote><p><strong>NOTE</strong> I set <code class="language-plaintext highlighter-rouge">/dev/mmcblk1</code> as that is what my SD card was linked to <strong>most</strong> of the time. I have not figured out a way to get more specific on my Pi, as sometimes it boots on <code class="language-plaintext highlighter-rouge">mmcblk0</code>.</p></blockquote><p>Now when we boot our device, a root partition will be automatically created, removing our need to include it in the initial image. To tie this all together and make it bootable, we can add our mount points to the configuration:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">fileSystems</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"/"</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">device</span> <span class="o">=</span> <span class="s2">"/dev/disk/by-partlabel/root"</span><span class="p">;</span>
    <span class="nv">fsType</span> <span class="o">=</span> <span class="s2">"xfs"</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="s2">"/boot"</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">device</span> <span class="o">=</span> <span class="s2">"/dev/disk/by-partlabel/boot"</span><span class="p">;</span>
    <span class="nv">fsType</span> <span class="o">=</span> <span class="s2">"vfat"</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="s2">"/nix/store"</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nv">device</span> <span class="o">=</span> <span class="s2">"/dev/disk/by-partlabel/nix-store_</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">image</span><span class="o">.</span><span class="nv">version</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
    <span class="nv">fsType</span> <span class="o">=</span> <span class="s2">"squashfs"</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>This utilizes partition labels to ensure we always boot the correct device.</p><h3 id="shrinking-it-down">Shrinking it Down</h3><p>Since we are creating an image for our configuration, we might as well try and make it smaller. I found this configuration to get me most of the way there:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">imports</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="nv">modulesPath</span> <span class="o">+</span> <span class="s2">"/profiles/minimal.nix"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">modulesPath</span> <span class="o">+</span> <span class="s2">"/profiles/image-based-appliance.nix"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">modulesPath</span> <span class="o">+</span> <span class="s2">"/profiles/perlless.nix"</span><span class="p">)</span>
<span class="p">];</span>
</pre></table></code></div></div><p>What do these modules do?</p><ul><li><code class="language-plaintext highlighter-rouge">minimal</code>: Disables most documentation and other programs like logrotate and xdg.<li><code class="language-plaintext highlighter-rouge">image-based-appliance</code>: Disables the nix package manager entirely and switches to systemd for the initrd and networking.<li><code class="language-plaintext highlighter-rouge">perlless</code>: Switches to non-Perl alternatives to some default services and enforces a zero-Perl policy.</ul><p>I found this to reduce my closure size a bit, and thus the image. Note that without Nix, an alternative mechanism will be required to update the system. This is what I will cover next.</p><h2 id="updates">Updates</h2><p>So far we have produced an image for initial deployment for a Raspberry Pi, but we cannot yet update it. Let’s solve this problem now.</p><p>We are going to use systemd-sysupdate to deploy updates to our device. In the previous code outlining the repart configuration, we had an option for <code class="language-plaintext highlighter-rouge">split = true</code> in the configuration. This instructs systemd-repart to not only produce our image but to produce files for each partition of that image. This allows us to deploy updates by distributing our Nix store and kernel with no unnecessary extras.</p><p>Here is the relevant host-side repart configuration:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="nv">systemd</span><span class="o">.</span><span class="nv">sysupdate</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nv">transfers</span> <span class="o">=</span> <span class="kd">let</span>
    <span class="nv">updateSource</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Path</span> <span class="o">=</span> <span class="s2">"http://localhost/"</span><span class="p">;</span>
      <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"url-file"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="kn">in</span> <span class="p">{</span>
    <span class="s2">"10-nix-store"</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Source</span> <span class="o">=</span>
        <span class="nv">updateSource</span>
        <span class="o">//</span> <span class="p">{</span>
          <span class="nv">MatchPattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">image</span><span class="o">.</span><span class="nv">id</span><span class="si">}</span><span class="s2">_@v.nix-store.raw.zst"</span><span class="p">];</span>
        <span class="p">};</span>

      <span class="nv">Target</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">InstancesMax</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nv">Path</span> <span class="o">=</span> <span class="s2">"auto"</span><span class="p">;</span>
        <span class="nv">MatchPattern</span> <span class="o">=</span> <span class="s2">"nix-store_@v"</span><span class="p">;</span>
        <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"partition"</span><span class="p">;</span>
        <span class="nv">ReadOnly</span> <span class="o">=</span> <span class="s2">"yes"</span><span class="p">;</span>
      <span class="p">};</span>

      <span class="nv">Transfer</span><span class="o">.</span><span class="nv">Verify</span> <span class="o">=</span> <span class="s2">"no"</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="s2">"20-boot-image"</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nv">Source</span> <span class="o">=</span>
        <span class="nv">updateSource</span>
        <span class="o">//</span> <span class="p">{</span>
          <span class="nv">MatchPattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">boot</span><span class="o">.</span><span class="nv">uki</span><span class="o">.</span><span class="nv">name</span><span class="si">}</span><span class="s2">_@v.efi"</span><span class="p">];</span>
        <span class="p">};</span>
      <span class="nv">Target</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c"># only keep 2 kernel images in the ESP partition</span>
        <span class="nv">InstancesMax</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nv">MatchPattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">boot</span><span class="o">.</span><span class="nv">uki</span><span class="o">.</span><span class="nv">name</span><span class="si">}</span><span class="s2">_@v.efi"</span><span class="p">];</span>
        <span class="nv">Mode</span> <span class="o">=</span> <span class="s2">"0444"</span><span class="p">;</span>
        <span class="nv">Path</span> <span class="o">=</span> <span class="s2">"/EFI/Linux"</span><span class="p">;</span>
        <span class="nv">PathRelativeTo</span> <span class="o">=</span> <span class="s2">"boot"</span><span class="p">;</span>
        <span class="nv">Type</span> <span class="o">=</span> <span class="s2">"regular-file"</span><span class="p">;</span>
      <span class="p">};</span>

      <span class="nv">Transfer</span><span class="o">.</span><span class="nv">Verify</span> <span class="o">=</span> <span class="s2">"no"</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>This defines rules to update both our nix store and the unified kernel image file. We define a maximum of two instances as we have only configured two nix store partitions. This can be configured for more if desired.</p><p>The partition labels and image files are configured to follow a specific file naming format. The sysupdate service uses the names of the partitions and files to determine how the updates are to be applied. In this case, our nix store is updated via partitioning while the kernel is a single unified kernel image file being saved into our ESP.</p><p>We currently instruct sysupdate to look at localhost for update files. You can use the default configuration of lighttpd to serve updates at <code class="language-plaintext highlighter-rouge">/srv/www</code> via:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">services</span><span class="o">.</span><span class="nv">lighttpd</span><span class="o">.</span><span class="nv">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></table></code></div></div><p>Or use your web server of choice.</p><p>Verifying the download with GPG is disabled for testing purposes only.</p><p>We define an output for our configuration to define a sysupdate “package”:</p><div class="language-nix highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">system</span><span class="o">.</span><span class="nv">build</span><span class="o">.</span><span class="nv">sysupdate-package</span> <span class="o">=</span> <span class="kd">let</span>
  <span class="kn">inherit</span> <span class="p">(</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="p">)</span> <span class="nv">build</span><span class="p">;</span>
  <span class="kn">inherit</span> <span class="p">(</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">image</span><span class="p">)</span> <span class="nv">version</span> <span class="nv">id</span><span class="p">;</span>
<span class="kn">in</span>
  <span class="nv">pkgs</span><span class="o">.</span><span class="nv">runCommand</span> <span class="s2">"sysupdate-package-</span><span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="s2">"</span> <span class="p">{}</span> <span class="s2">''</span><span class="err">
</span><span class="s2">    mkdir $out</span><span class="err">
</span><span class="s2">    cp </span><span class="si">${</span><span class="nv">build</span><span class="o">.</span><span class="nv">uki</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">config</span><span class="o">.</span><span class="nv">system</span><span class="o">.</span><span class="nv">boot</span><span class="o">.</span><span class="nv">loader</span><span class="o">.</span><span class="nv">ukiFile</span><span class="si">}</span><span class="s2"> $out/</span><span class="err">
</span><span class="s2">    cp </span><span class="si">${</span><span class="nv">build</span><span class="o">.</span><span class="nv">image</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">id</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">version</span><span class="si">}</span><span class="s2">.nix-store.raw.zst $out/</span><span class="err">
</span><span class="s2">    cd $out</span><span class="err">
</span><span class="s2">    sha256sum * &gt; SHA256SUMS</span><span class="err">
</span><span class="s2">  ''</span><span class="p">;</span>
</pre></table></code></div></div><p>This derivation builds a “package” containing the unified kernel image and nix-store image that we can use to deploy updates to our Raspberry Pi. A SHA256SUMS file is also built so we can verify the integrity of the files.</p><p>This just copies all of our image files into one spot that we can deploy by copying to <code class="language-plaintext highlighter-rouge">/srv/www</code> on the imaged system.</p><p>We then copy the contents of this package to the <code class="language-plaintext highlighter-rouge">/srv/www</code> folder on our Raspberry Pi through SSH or your preferred method.</p><p>Applying the update is as easy as:</p><pre><code class="language-ShellSession"># updatectl update
</code></pre><p>A nice progress bar is shown to indicate the progress of the operation. Once finished, a reboot will take you to the new version.</p><p>In this case, we have two image partitions. With this, we still have our previous revision available to boot on the bootloader screen.</p><h1 id="conclusion">Conclusion</h1><p>What has been demonstrated here is how to create images suitable for embedded deployments of NixOS.</p><p>What I find to be the most interesting about this is how systemd has made itself useful in almost all aspects of making a Linux distribution. The way all the pieces fit together and are configured really demonstrates cohesiveness when other systems may not feel so simple.</p><p>Systemd is a topic I am going to explore in future posts. Specifically, I am interested in replacing every part of my system for which systemd has a counterpart. It will be an experiment, and we will see if it is a positive or negative experience for my desktop Linux workflow.</p><p>The source for my system in this article can be found <a href="https://github.com/Lyndeno/nix-config/blob/ba5528c5b638713adb43b680559f1b4edabccde8/hosts/trinity/configuration.nix">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorials/'>Tutorials</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nix/" class="post-tag no-text-decoration" >nix</a> <a href="/tags/nixos/" class="post-tag no-text-decoration" >nixos</a> <a href="/tags/systemd/" class="post-tag no-text-decoration" >systemd</a> <a href="/tags/repart/" class="post-tag no-text-decoration" >repart</a> <a href="/tags/sysupdate/" class="post-tag no-text-decoration" >sysupdate</a> <a href="/tags/raspberry/" class="post-tag no-text-decoration" >raspberry</a> <a href="/tags/pi/" class="post-tag no-text-decoration" >pi</a> <a href="/tags/embedded/" class="post-tag no-text-decoration" >embedded</a> <a href="/tags/kiosk/" class="post-tag no-text-decoration" >kiosk</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/image/" class="post-tag no-text-decoration" >image</a> <a href="/tags/update/" class="post-tag no-text-decoration" >update</a> <a href="/tags/deployment/" class="post-tag no-text-decoration" >deployment</a> <a href="/tags/cross/" class="post-tag no-text-decoration" >cross</a> <a href="/tags/compile/" class="post-tag no-text-decoration" >compile</a> <a href="/tags/minimal/" class="post-tag no-text-decoration" >minimal</a> <a href="/tags/secure/" class="post-tag no-text-decoration" >secure</a> <a href="/tags/compression/" class="post-tag no-text-decoration" >compression</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Reproducable, flashable, updateable Raspberry Pi Images with NixOS - Lyndon Sanche&url=https://lyndeno.ca/posts/nixos-repart-image/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Reproducable, flashable, updateable Raspberry Pi Images with NixOS - Lyndon Sanche&u=https://lyndeno.ca/posts/nixos-repart-image/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Reproducable, flashable, updateable Raspberry Pi Images with NixOS - Lyndon Sanche&url=https://lyndeno.ca/posts/nixos-repart-image/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/online-presence-resume/">Automating Your Resume with Github</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/announcement/">announcement</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/actions/">actions</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/compile/">compile</a> <a class="post-tag" href="/tags/compression/">compression</a> <a class="post-tag" href="/tags/computers/">computers</a> <a class="post-tag" href="/tags/cross/">cross</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/embedded/">embedded</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/setting-up-external-monitor-brightness/"><div class="card-body"> <span class="timeago small" > Oct 29, 2020 <i class="unloaded">2020-10-29T16:30:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Setting up External Monitor Brightness Controls on Arch Linux</h3><div class="text-muted small"><p> This will be the first technical post on my website. I will use this post to describe the process in setting up external brightness control in Sway on Arch Linux. Background Kernel 5.9 added impr...</p></div></div></a></div><div class="card"> <a href="/posts/online-presence-resume/"><div class="card-body"> <span class="timeago small" > Apr 24, 2021 <i class="unloaded">2021-04-24T01:20:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Automating Your Resume with Github</h3><div class="text-muted small"><p> Background Making your resume easily available and up to date can be quite the task. The approach I have taken is to host my resume on Github. Github has tools that make it easy to have links that...</p></div></div></a></div><div class="card"> <a href="/posts/new-website-launch/"><div class="card-body"> <span class="timeago small" > Sep 10, 2020 <i class="unloaded">2020-09-10T13:25:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>New website live</h3><div class="text-muted small"><p> The new website design is now live. You should now be reading this at lyndeno.ca.</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/online-presence-resume/" class="btn btn-outline-primary" prompt="Older"><p>Automating Your Resume with Github</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://github.com/Lyndeno">Lyndon Sanche</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/announcement/">announcement</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/actions/">actions</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/compile/">compile</a> <a class="post-tag" href="/tags/compression/">compression</a> <a class="post-tag" href="/tags/computers/">computers</a> <a class="post-tag" href="/tags/cross/">cross</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/embedded/">embedded</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://lyndeno.ca{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
